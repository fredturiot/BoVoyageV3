<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8" />
    <title>Nouveau Dossier</title>
    <link rel="stylesheet" type="text/css" href="../CSS/style.css" />
    <script src="../JS/script.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
        crossorigin="anonymous" />
</head>

<body>
    <div class="row">


        <div class="main  col-lg-3 col-md-6 col-sm-6">

            <div class="container-fluid">
                <h3>Editer le Dossier</h3>

                <form novalidate>

                    <div class="form-group">
                        <label for="NumeroCB">Numero de Carte Bancaire</label>
                        <input type="text" placeholder="Numero de Carte Bancaire" class="form-control" id="NumeroCB"
                            required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>


                    <div class="form-group">
                        <label for="PrixPersonne">Prix par personnes</label>
                        <input type="number" placeholder="Prix par Personne" class="form-control" id="PrixPersonne"
                            required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="Voyage">Voyage</label>
                        <select class="form-control" id="Voyage" required></select>
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="Client">Client</label>
                        <select class="form-control" id="Client" required></select>
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="NbParticipant">Nombre de Participants</label>
                        <input type="number" min="1" max="9" class="form-control" id="NbParticipant" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="return ValiderNbParticipant();">valider</button>

                </form>



                <div class="actions">
                    <br>
                    <button class="btn btn-primary" onclick="return Enregistrer();">Enregistrer</button>
                    <a href="/" class="btn btn-light">Annuler</a>
                </div>
            </div>
        </div>

        <div class="main col-lg-3 col-md-6 col-sm-6">
            <div class="container-fluid">
                <h3>Validations</h3>
                <br>
                <button class="btn btn-primary" onclick="return  VerifierSolvabilite();">Verifier Solvabilité</button>
                <br><br>
                <button class="btn btn-success" onclick="return  AccepterDossier();">Accepter la reservation</button>
                <br><br>
                <button class="btn btn-danger" onclick="return  RefuserDossier();">Refuser la reservation</button>

                <br><br>
                <div class="form-group">
                    <label style="display: block;">Etat de la réservation</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Etat" id="enAttente" value="0">
                        <label class="form-check-label" for="enAttente">En Attente</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Etat" id="enCours" value="1">
                        <label class="form-check-label" for="enCours">En Cours</label>
                    </div>
                    <br>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Etat" id="refusee" value="2">
                        <label class="form-check-label" for="refusee">Refusée</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Etat" id="acceptee" value="3">
                        <label class="form-check-label" for="acceptee">Acceptée</label>
                    </div>
                    <br><br>
                    <!-- <button class="btn btn-danger" onclick="return  ValiderEtat();">Valider le changement d'état</button> -->
                </div>

                <div class="form-group">
                    <label style="display: block;">Annulation</label>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Annulation" id="client" value="0">
                        <label class="form-check-label" for="client">Client</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="Annulation" id="placeInsuffisantes" value="1">
                        <label class="form-check-label" for="placeInsuffisantes">Place Insuffisantes</label>
                    </div>
                    <br><br>
                    <button class="btn btn-danger" onclick="return  AnnulerDossier();">Annuler la réservation</button>
                </div>

            </div>
        </div>

        <div class="main col-lg-2 col-md-6 col-sm-6">
            <div class="container-fluid">
                <div class="form-group">
                    <label for="ParticipantSelector">Participant à modifier</label>
                    <select class="form-control" id="ParticipantSelector" required></select>
                    <div class="invalid-feedback">
                        Champ requis
                    </div>
                    <br>
                    <button class="btn btn-primary" onclick="return ModifierParticipant();">modifier ce participant</button>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <br>
                    <button class="btn btn-warning" onclick="return AjouterParticipant();">Ajouter ce participant</button>
                </div>
            </div>
        </div>

        <div class="main col-lg-3 col-md-6 col-sm-6">
            <div class="container-fluid">
                <h3>Participant</h3>

                <form novalidate>
                    <div class="form-group">
                        <label for="Civilite">Civilité</label>
                        <input type="text" placeholder="Civilité" class="form-control" id="Civilite" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="Nom">Nom</label>
                        <input type="text" placeholder="Nom" class="form-control" id="Nom" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="Prenom">Prenom</label>
                        <input type="text" placeholder="Prenom" class="form-control" id="Prenom" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="Adresse">Adresse</label>
                        <input type="text" placeholder="Adresse" class="form-control" id="Adresse" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="Telephone">Telephone</label>
                        <input type="text" placeholder="Telephone" class="form-control" id="Telephone" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="DateNaissance">Date de naissance</label>
                        <input type="date" class="form-control" id="DateNaissance" />
                    </div>
                    <div class="form-group">
                        <label for="Reduction">Reduction</label>
                        <input type="text" placeholder="Reduction" class="form-control" id="Reduction" required />
                        <div class="invalid-feedback">
                            Champ requis
                        </div>
                    </div>


                </form>

            </div>
        </div>

    </div>
    <script>


        //menu déroulant

        function AppendLoadToSelect(selectIdVoyage, selectIdclient) {
            var select = $("#" + selectIdVoyage);
            select.empty();
            select.append($('<option></option>'));
            let pro = Load('voyages');//edit controller name
            pro.then(function (values) {
                for (item of values) {
                    var option = $('<option></option>');
                    option.val(item.ID);
                    option.text('Dest: ' + item.DestinationID + ' Agence: ' + item.AgenceVoyageID + ' - ' + ' Aller: ' + item.DateAller + ' - ' + ' Retour: ' + item.DateRetour);//edit here          
                    select.append(option);
                }
            });
            var select2 = $("#" + selectIdclient);
            select2.empty();
            select2.append($('<option></option>'));
            pro = Load('clients');//edit controller name
            pro.then(function (values) {
                for (item of values) {
                    var option = $('<option></option>');
                    option.val(item.ID);
                    option.text(item.Nom + ' ' + item.Prenom + ' - ' + item.Email);//edit here          
                    select2.append(option);
                }
            });
        }
        function AjouterParticipant() {
            //ToDo
        }
        function ModifierParticipant() {
            //ToDo
        }
        function VerifierSolvabilite() {
            //ToDo
        }
        function AccepterDossier() {
            //ToDo
        }
        function RefuserDossier() {
            //ToDo
        }

        /* function ValiderEtat() {
            //ToDo
        } */
        function AnnulerDossier() {
            //ToDo
        }


            
           
        $(document).ready(function () { 
            var id = GetURLParameter('id');

            promise = Load('DossiersReservations', id); 
            promise.then(function (item) {
                $('#NumeroCB').val(item.NumeroCarteBancaire);
                $('#PrixPersonne').val(item.PrixParPersonne);
                $('[name=Etat]:checked').val(item.Etat)
                /* $('#Voyage').val(item.VoyageID);
                $('#Client').val(item.ClientID); */
                $('#NbParticipant').val(item.XXXXXXXXX);//TODO
            });

            AppendLoadToSelect('Voyage','Client');
        })

        function Valider() {
            var form = $('form');
            let estValide = form[0].checkValidity();
            form.addClass("was-validated");

            return estValide;
        }

        function Enregistrer(id) {
            if (!Valider()) {
                return false;
            }
            var id = GetURLParameter('id');

            let dossierReservation = { 
                NumeroCarteBancaire: $('#NumeroCB').val(),
                PrixParPersonne: $('#PrixPersonne').val(),
                VoyageID: $('#Voyage').val(),
                ClientID: $('#Client').val(),
                Etat: $('[name=Etat]:checked').val(),
                XXXXXX: $('#NbParticipant').val()//TODO
            };

            $.ajax({
                type: 'PUT',
                url: '/api/DossiersReservations/' + id,
                data: dossierReservation,
                success: function () {
                    window.location.href = '/Application/HTML/DossierList.html';
                },
                error: function (response) {
                    Erreur(response);
                }
            });

            return false;
        }





    </script>
</body>

</html>